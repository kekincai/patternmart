const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CouponProviderAdapter-BqMiv_Mm.js","./LocalJsonCouponProvider-BF4-LJGx.js","./PremiumCheckoutPipeline-Bf6FaizM.js","./CheckoutPipeline-DhzDqX0E.js"])))=>i.map(i=>d[i]);
var St=Object.defineProperty;var wt=(l,t,e)=>t in l?St(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var i=(l,t,e)=>wt(l,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const Ct=[{id:"p1",name:"æœ‰æœºè‹¹æœ",price:25,category:"Food",icon:"ğŸ",description:"æ–°é²œæœ‰æœºçº¢å¯Œå£«è‹¹æœ"},{id:"p2",name:"è¿›å£ç‰›æ’",price:128,category:"Food",icon:"ğŸ¥©",description:"æ¾³æ´²å’Œç‰›M5çº§"},{id:"p3",name:"æ‰‹å·¥é¢åŒ…",price:18,category:"Food",icon:"ğŸ",description:"æ³•å¼å…¨éº¦é¢åŒ…"},{id:"p4",name:"æ— çº¿è€³æœº",price:299,category:"Tech",icon:"ğŸ§",description:"ä¸»åŠ¨é™å™ªè“ç‰™è€³æœº"},{id:"p5",name:"æœºæ¢°é”®ç›˜",price:459,category:"Tech",icon:"âŒ¨ï¸",description:"87é”®çº¢è½´æœºæ¢°é”®ç›˜"},{id:"p6",name:"æ™ºèƒ½æ‰‹è¡¨",price:899,category:"Tech",icon:"âŒš",description:"è¿åŠ¨å¥åº·ç›‘æµ‹æ‰‹è¡¨"},{id:"p7",name:"ç§»åŠ¨ç”µæº",price:129,category:"Tech",icon:"ğŸ”‹",description:"20000mAhå¿«å……ç§»åŠ¨ç”µæº"},{id:"p8",name:"è®¾è®¡æ¨¡å¼",price:89,category:"Book",icon:"ğŸ“˜",description:"GoF è®¾è®¡æ¨¡å¼ç»å…¸è‘—ä½œ"},{id:"p9",name:"ä»£ç æ•´æ´ä¹‹é“",price:79,category:"Book",icon:"ğŸ“—",description:"ç¼–å†™å¯ç»´æŠ¤ä»£ç çš„è‰ºæœ¯"},{id:"p10",name:"é‡æ„",price:99,category:"Book",icon:"ğŸ“™",description:"æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡"},{id:"p11",name:"ç®—æ³•å¯¼è®º",price:139,category:"Book",icon:"ğŸ“•",description:"è®¡ç®—æœºç®—æ³•ç»å…¸æ•™æ"},{id:"p12",name:"æœ‰æœºè”¬èœç¤¼ç›’",price:68,category:"Food",icon:"ğŸ¥¬",description:"æ—¶ä»¤æœ‰æœºè”¬èœç»„åˆ"}],_=class _{constructor(){i(this,"products",new Map);Ct.forEach(t=>this.products.set(t.id,t))}static getInstance(){return _.instance||(_.instance=new _),_.instance}getAll(){return Array.from(this.products.values())}getById(t){return this.products.get(t)}getByCategory(t){return this.getAll().filter(e=>e.category===t)}search(t){const e=t.toLowerCase();return this.getAll().filter(n=>{var o;return n.name.toLowerCase().includes(e)||((o=n.description)==null?void 0:o.toLowerCase().includes(e))})}};i(_,"instance",null);let M=_;class $t{constructor(t){i(this,"state");i(this,"timestamp");this.state=t,this.timestamp=new Date}getState(){return this.state}getTimestamp(){return this.timestamp}}class r{static log(t,e){const o={timestamp:new Date().toTimeString().split(" ")[0],pattern:t,message:e};this.entries.push(o),this.renderEntry(o),this.scrollToBottom()}static clear(){this.entries=[],this.body&&(this.body.innerHTML="")}static render(){var o;if(this.container)return;this.container=document.createElement("div"),this.container.className="demo-console",this.container.innerHTML=`
      <div class="demo-console-header">
        <span class="demo-console-title">ğŸ–¥ï¸ Demo Console</span>
        <div class="demo-console-controls">
          <button class="btn-clear" title="æ¸…ç©º">ğŸ—‘ï¸</button>
          <button class="btn-toggle" title="æŠ˜å /å±•å¼€">â–¼</button>
        </div>
      </div>
      <div class="demo-console-filter">
        <input type="text" placeholder="æŒ‰æ¨¡å¼åç§°è¿‡æ»¤..." />
      </div>
      <div class="demo-console-body"></div>
    `,document.body.appendChild(this.container),this.body=this.container.querySelector(".demo-console-body"),this.filterInput=this.container.querySelector(".demo-console-filter input");const t=this.container.querySelector(".demo-console-header"),e=this.container.querySelector(".btn-clear"),n=this.container.querySelector(".btn-toggle");t==null||t.addEventListener("click",s=>{s.target.closest(".demo-console-controls")||this.toggle()}),e==null||e.addEventListener("click",s=>{s.stopPropagation(),this.clear()}),n==null||n.addEventListener("click",s=>{s.stopPropagation(),this.toggle()}),(o=this.filterInput)==null||o.addEventListener("input",s=>{this.currentFilter=s.target.value.toLowerCase(),this.rerender()}),this.rerender()}static toggle(){if(this.isCollapsed=!this.isCollapsed,this.container){this.container.classList.toggle("collapsed",this.isCollapsed);const t=this.container.querySelector(".btn-toggle");t&&(t.textContent=this.isCollapsed?"â–²":"â–¼")}}static renderEntry(t){if(!this.body||this.currentFilter&&!t.pattern.toLowerCase().includes(this.currentFilter))return;const e=document.createElement("div");e.className="console-line",e.innerHTML=`
      <span class="timestamp">[${t.timestamp}]</span>
      <span class="pattern-name">[${t.pattern}]</span>
      <span class="message">${this.escapeHtml(t.message)}</span>
    `,this.body.appendChild(e)}static rerender(){if(this.body){this.body.innerHTML="";for(const t of this.entries)this.renderEntry(t);this.scrollToBottom()}}static scrollToBottom(){this.body&&(this.body.scrollTop=this.body.scrollHeight)}static escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}static getEntries(){return[...this.entries]}}i(r,"entries",[]),i(r,"container",null),i(r,"body",null),i(r,"filterInput",null),i(r,"isCollapsed",!1),i(r,"currentFilter","");class Y{get(t){try{return localStorage.getItem(t)}catch{return null}}set(t,e){try{localStorage.setItem(t,e)}catch{console.warn("LocalStorage å†™å…¥å¤±è´¥")}}remove(t){try{localStorage.removeItem(t)}catch{}}clear(){try{localStorage.clear()}catch{}}}const S=class S{constructor(){i(this,"items",[]);i(this,"observers",[]);i(this,"storage",new Y);i(this,"STORAGE_KEY","patternmart_cart")}static getInstance(){return S.instance||(S.instance=new S),S.instance}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(e=>e!==t)}notify(){r.log("Observer",`è´­ç‰©è½¦å˜åŒ–ï¼Œé€šçŸ¥ ${this.observers.length} ä¸ªè§‚å¯Ÿè€…`),this.observers.forEach(t=>t()),this.saveToStorage()}addItem(t,e=1){const n=this.items.find(o=>o.product.id===t.id);n?n.quantity+=e:this.items.push({product:t,quantity:e}),this.notify()}removeItem(t){this.items=this.items.filter(e=>e.product.id!==t),this.notify()}updateQuantity(t,e){const n=this.items.find(o=>o.product.id===t);n&&(e<=0?this.removeItem(t):(n.quantity=e,this.notify()))}clear(){this.items=[],this.notify()}getItems(){return[...this.items]}getTotalQuantity(){return this.items.reduce((t,e)=>t+e.quantity,0)}getTotalAmount(){return this.items.reduce((t,e)=>t+e.product.price*e.quantity,0)}createMemento(){return new $t(JSON.parse(JSON.stringify(this.items)))}restoreFromMemento(t){this.items=JSON.parse(JSON.stringify(t.getState())),this.notify()}saveToStorage(){this.storage.set(this.STORAGE_KEY,JSON.stringify(this.items))}loadFromStorage(){const t=this.storage.get(this.STORAGE_KEY);if(t)try{this.items=JSON.parse(t)}catch{this.items=[]}}};i(S,"instance",null);let m=S;const x=Object.freeze(Object.defineProperty({__proto__:null,Cart:m},Symbol.toStringTag,{value:"Module"})),w=class w{constructor(){i(this,"history",[]);i(this,"redoStack",[])}static getInstance(){return w.instance||(w.instance=new w),w.instance}execute(t){t.execute(),this.history.push(t),this.redoStack=[]}undo(){const t=this.history.pop();return t?(t.undo(),this.redoStack.push(t),!0):(r.log("Command","æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ"),!1)}redo(){const t=this.redoStack.pop();return t?(t.execute(),this.history.push(t),!0):(r.log("Command","æ²¡æœ‰å¯é‡åšçš„æ“ä½œ"),!1)}canUndo(){return this.history.length>0}canRedo(){return this.redoStack.length>0}clear(){this.history=[],this.redoStack=[]}getHistory(){return this.history.map(t=>t.getDescription())}};i(w,"instance",null);let A=w;const It=Object.freeze(Object.defineProperty({__proto__:null,CommandManager:A},Symbol.toStringTag,{value:"Module"}));class W{constructor(t,e,n=1){i(this,"cart");i(this,"product");i(this,"quantity");this.cart=t,this.product=e,this.quantity=n}execute(){this.cart.addItem(this.product,this.quantity),r.log("Command",`æ‰§è¡Œ: æ·»åŠ  ${this.product.name} x${this.quantity}`)}undo(){const t=this.cart.getItems().find(e=>e.product.id===this.product.id);if(t){const e=t.quantity-this.quantity;e<=0?this.cart.removeItem(this.product.id):this.cart.updateQuantity(this.product.id,e)}r.log("Command",`æ’¤é”€: ç§»é™¤ ${this.product.name} x${this.quantity}`)}getDescription(){return`æ·»åŠ  ${this.product.name} x${this.quantity}`}}const Pt=Object.freeze(Object.defineProperty({__proto__:null,AddItemCommand:W},Symbol.toStringTag,{value:"Module"}));class Tt{constructor(){i(this,"container");this.container=document.createElement("div"),this.container.className="product-grid"}render(){const t=M.getInstance().getAll();return this.container.innerHTML=t.map(e=>this.renderProduct(e)).join(""),this.container.querySelectorAll(".btn-add-cart").forEach(e=>{e.addEventListener("click",n=>{const o=n.target.dataset.productId;o&&this.addToCart(o)})}),this.container}renderProduct(t){return`
      <div class="card product-card">
        <div class="product-image">${t.icon||"ğŸ“¦"}</div>
        <span class="product-category">${t.category}</span>
        <h3 class="card-title">${t.name}</h3>
        <p class="card-text">${t.description||""}</p>
        <div class="flex justify-between items-center">
          <span class="product-price">Â¥${t.price}</span>
          <button class="btn btn-primary btn-add-cart" data-product-id="${t.id}">
            åŠ å…¥è´­ç‰©è½¦
          </button>
        </div>
      </div>
    `}addToCart(t){const e=M.getInstance().getById(t);if(e){const n=m.getInstance(),o=new W(n,e,1);A.getInstance().execute(o),r.log("Observer",`å•†å“ "${e.name}" å·²åŠ å…¥è´­ç‰©è½¦`)}}}class z{render(){const t=document.createElement("div");t.innerHTML=`
      <h1 class="page-title">ğŸ›ï¸ å•†å“ç›®å½•</h1>
      <p class="mb-2">ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"è§¦å‘ Command + Observer æ¨¡å¼</p>
    `;const e=new Tt;return t.appendChild(e.render()),t}}class K{constructor(t,e,n){i(this,"cart");i(this,"productId");i(this,"newQuantity");i(this,"oldQuantity",0);this.cart=t,this.productId=e,this.newQuantity=n}execute(){const t=this.cart.getItems().find(e=>e.product.id===this.productId);t&&(this.oldQuantity=t.quantity,this.cart.updateQuantity(this.productId,this.newQuantity),r.log("Command",`æ‰§è¡Œ: ä¿®æ”¹æ•°é‡ ${this.oldQuantity} -> ${this.newQuantity}`))}undo(){this.cart.updateQuantity(this.productId,this.oldQuantity),r.log("Command",`æ’¤é”€: æ¢å¤æ•°é‡ ${this.newQuantity} -> ${this.oldQuantity}`)}getDescription(){return`è®¾ç½®æ•°é‡ä¸º ${this.newQuantity}`}}const Et=Object.freeze(Object.defineProperty({__proto__:null,SetQtyCommand:K},Symbol.toStringTag,{value:"Module"}));class At{constructor(t,e){i(this,"cart");i(this,"productId");i(this,"removedItem",null);this.cart=t,this.productId=e}execute(){this.removedItem=this.cart.getItems().find(t=>t.product.id===this.productId)||null,this.removedItem&&(this.cart.removeItem(this.productId),r.log("Command",`æ‰§è¡Œ: ç§»é™¤ ${this.removedItem.product.name}`))}undo(){this.removedItem&&(this.cart.addItem(this.removedItem.product,this.removedItem.quantity),r.log("Command",`æ’¤é”€: æ¢å¤ ${this.removedItem.product.name} x${this.removedItem.quantity}`))}getDescription(){return`ç§»é™¤å•†å“ ${this.productId}`}}const C=class C{constructor(){i(this,"listeners",new Map)}static getInstance(){return C.instance||(C.instance=new C),C.instance}notify(t,e,n){switch(r.log("Mediator",`[${t}] è§¦å‘äº‹ä»¶: ${e}`),e){case"couponApplied":r.log("Mediator","  -> é€šçŸ¥ PricingSummary é‡æ–°è®¡ç®—"),r.log("Mediator","  -> é€šçŸ¥ CartPanel æ›´æ–°æ˜¾ç¤º");break;case"quantityChanged":r.log("Mediator","  -> é€šçŸ¥ PricingSummary é‡æ–°è®¡ç®—"),r.log("Mediator","  -> é€šçŸ¥ CouponPanel æ£€æŸ¥ä¼˜æƒ åˆ¸æœ‰æ•ˆæ€§");break;case"shippingChanged":case"taxChanged":r.log("Mediator","  -> é€šçŸ¥ PricingSummary é‡æ–°è®¡ç®—");break}const o=this.listeners.get(e);o&&o.forEach(s=>s(n))}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){const n=this.listeners.get(t);if(n){const o=n.indexOf(e);o>-1&&n.splice(o,1)}}};i(C,"instance",null);let O=C;const Ot=Object.freeze(Object.defineProperty({__proto__:null,CheckoutMediator:O},Symbol.toStringTag,{value:"Module"}));class Lt{constructor(){i(this,"container");i(this,"cart");this.container=document.createElement("div"),this.container.className="cart-panel",this.cart=m.getInstance(),this.cart.subscribe(()=>this.update())}render(){return this.update(),this.container}update(){const t=this.cart.getItems();if(t.length===0){this.container.innerHTML='<p class="text-center">è´­ç‰©è½¦æ˜¯ç©ºçš„</p>';return}this.container.innerHTML=`
      <h3>è´­ç‰©è½¦</h3>
      ${t.map(e=>`
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${e.product.icon||""} ${e.product.name}</div>
            <div class="cart-item-price">Â¥${e.product.price} Ã— ${e.quantity}</div>
          </div>
          <div class="cart-item-qty">
            <input type="number" class="form-control qty-input" 
                   value="${e.quantity}" min="1" 
                   data-product-id="${e.product.id}">
            <button class="btn btn-danger btn-sm btn-remove" 
                    data-product-id="${e.product.id}">âœ•</button>
          </div>
        </div>
      `).join("")}
      <div class="pricing-total">
        å°è®¡: Â¥${this.cart.getTotalAmount().toFixed(2)}
      </div>
    `,this.bindEvents()}bindEvents(){this.container.querySelectorAll(".qty-input").forEach(t=>{t.addEventListener("change",e=>{const n=e.target,o=n.dataset.productId,s=parseInt(n.value,10);if(s>0){const a=new K(this.cart,o,s);A.getInstance().execute(a),O.getInstance().notify("CartPanel","quantityChanged",{productId:o,quantity:s})}})}),this.container.querySelectorAll(".btn-remove").forEach(t=>{t.addEventListener("click",e=>{const n=e.target.dataset.productId,o=new At(this.cart,n);A.getInstance().execute(o),O.getInstance().notify("CartPanel","quantityChanged",{productId:n,quantity:0})})})}}const q=[{code:"SAVE10",type:"percent",value:10,description:"å…¨åœº9æŠ˜",minAmount:100},{code:"MINUS30",type:"fixed",value:30,description:"æ»¡200å‡30",minAmount:200},{code:"FREESHIP",type:"freeShip",value:0,description:"å…è¿è´¹",minAmount:150},{code:"VIP20",type:"percent",value:20,description:"VIPä¸“äº«8æŠ˜",minAmount:300,maxDiscount:100}];class X{constructor(){i(this,"cache",new Map)}async validate(t,e){const n=`${t}_${e}`;if(this.cache.has(n))return r.log("Proxy",`ç¼“å­˜å‘½ä¸­: ${t}`),this.cache.get(n);r.log("Proxy",`é¦–æ¬¡éªŒè¯ ${t}ï¼Œæ‰§è¡Œå®é™…æ ¡éªŒ...`),await new Promise(a=>setTimeout(a,200));const o=q.find(a=>a.code===t);let s;return o?o.minAmount&&e<o.minAmount?s={valid:!1,message:`è®¢å•é‡‘é¢éœ€æ»¡ Â¥${o.minAmount}`}:s={valid:!0,message:`ä¼˜æƒ åˆ¸æœ‰æ•ˆ: ${o.description}`}:s={valid:!1,message:"ä¼˜æƒ åˆ¸ä¸å­˜åœ¨"},this.cache.set(n,s),r.log("Proxy","éªŒè¯å®Œæˆï¼Œç»“æœå·²ç¼“å­˜"),s}clearCache(){this.cache.clear(),r.log("Proxy","ç¼“å­˜å·²æ¸…é™¤")}}const kt=Object.freeze(Object.defineProperty({__proto__:null,CouponValidatorProxy:X},Symbol.toStringTag,{value:"Module"}));class Rt{constructor(){i(this,"container");i(this,"appliedCoupon",null);i(this,"validator",new X);this.container=document.createElement("div"),this.container.className="card"}render(){return this.container.innerHTML=`
      <h3>ä¼˜æƒ åˆ¸</h3>
      <div class="form-group">
        <label class="form-label">é€‰æ‹©ä¼˜æƒ åˆ¸</label>
        <select id="coupon-select" class="form-control">
          <option value="">-- ä¸ä½¿ç”¨ä¼˜æƒ åˆ¸ --</option>
          ${q.map(t=>`
            <option value="${t.code}">${t.code} - ${t.description}</option>
          `).join("")}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">æˆ–è¾“å…¥åˆ¸ç </label>
        <div class="flex gap-1">
          <input type="text" id="coupon-input" class="form-control" placeholder="è¾“å…¥ä¼˜æƒ åˆ¸ç ">
          <button id="btn-apply-coupon" class="btn btn-primary">åº”ç”¨</button>
        </div>
      </div>
      <div id="coupon-status" class="mt-1"></div>
    `,this.bindEvents(),this.container}bindEvents(){const t=this.container.querySelector("#coupon-select"),e=this.container.querySelector("#coupon-input"),n=this.container.querySelector("#btn-apply-coupon");t.addEventListener("change",()=>{e.value=t.value}),n.addEventListener("click",async()=>{const o=e.value.trim();o&&await this.applyCoupon(o)})}async applyCoupon(t){const e=this.container.querySelector("#coupon-status"),n=m.getInstance().getTotalAmount();r.log("Proxy",`éªŒè¯ä¼˜æƒ åˆ¸: ${t}`);const o=await this.validator.validate(t,n);o.valid?(this.appliedCoupon=t,e.innerHTML=`<span style="color: var(--success-color)">âœ“ ${o.message}</span>`,O.getInstance().notify("CouponPanel","couponApplied",{code:t})):e.innerHTML=`<span style="color: var(--danger-color)">âœ— ${o.message}</span>`}getAppliedCoupon(){return this.appliedCoupon}}class Z{constructor(t){i(this,"mementos",[]);i(this,"cart");this.cart=t}save(){const t=this.cart.createMemento();this.mementos.push(t),r.log("Memento",`ä¿å­˜å¿«ç…§ #${this.mementos.length}ï¼Œæ—¶é—´: ${t.getTimestamp().toLocaleTimeString()}`)}restore(){const t=this.mementos.pop();return t?(this.cart.restoreFromMemento(t),r.log("Memento",`æ¢å¤åˆ°å¿«ç…§ï¼Œæ—¶é—´: ${t.getTimestamp().toLocaleTimeString()}`),!0):(r.log("Memento","æ²¡æœ‰å¯æ¢å¤çš„å¿«ç…§"),!1)}getSnapshotCount(){return this.mementos.length}clear(){this.mementos=[]}}const Dt=Object.freeze(Object.defineProperty({__proto__:null,CartCaretaker:Z},Symbol.toStringTag,{value:"Module"}));class N{constructor(){i(this,"next",null)}setNext(t){return this.next=t,t}handle(t){this.process(t),this.next&&this.next.handle(t)}}class tt extends N{process(t){if(!t.couponCode){r.log("Chain of Responsibility","ä¼˜æƒ åˆ¸å¤„ç†å™¨: æ— ä¼˜æƒ åˆ¸ï¼Œè·³è¿‡");return}const e=q.find(o=>o.code===t.couponCode);if(!e){r.log("Chain of Responsibility",`ä¼˜æƒ åˆ¸å¤„ç†å™¨: åˆ¸ç  ${t.couponCode} æ— æ•ˆ`);return}if(e.minAmount&&t.subtotal<e.minAmount){r.log("Chain of Responsibility",`ä¼˜æƒ åˆ¸å¤„ç†å™¨: æœªè¾¾åˆ°æœ€ä½æ¶ˆè´¹ Â¥${e.minAmount}`);return}let n=0;e.type==="percent"?(n=t.currentAmount*(e.value/100),e.maxDiscount&&(n=Math.min(n,e.maxDiscount))):e.type==="fixed"&&(n=e.value),t.currentAmount-=n,t.discounts.push({name:`ä¼˜æƒ åˆ¸(${e.code})`,amount:n}),r.log("Chain of Responsibility",`ä¼˜æƒ åˆ¸å¤„ç†å™¨: åº”ç”¨ ${e.code}ï¼ŒæŠ˜æ‰£ Â¥${n.toFixed(2)}`)}}const xt=Object.freeze(Object.defineProperty({__proto__:null,CouponDiscountHandler:tt},Symbol.toStringTag,{value:"Module"})),$=class ${constructor(){i(this,"instanceId");i(this,"config",{appName:"PatternMart",version:"1.0.0",currency:"CNY",locale:"zh-CN",taxRate:.1,freeShippingThreshold:300,memberDiscounts:{None:0,Silver:.05,Gold:.1},thresholdDiscount:{threshold:200,discount:30},weekendDiscount:.05,isWeekendMode:!1});this.instanceId=`config_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getInstance(){return $.instance||($.instance=new $),$.instance}getInstanceId(){return this.instanceId}get(t){return this.config[t]}set(t,e){this.config[t]=e}getAll(){return{...this.config}}toggleWeekendMode(){return this.config.isWeekendMode=!this.config.isWeekendMode,this.config.isWeekendMode}};i($,"instance",null);let v=$;class et extends N{process(t){const e=v.getInstance(),{threshold:n,discount:o}=e.get("thresholdDiscount");t.subtotal>=n?(t.currentAmount-=o,t.discounts.push({name:`æ»¡${n}å‡${o}`,amount:o}),r.log("Chain of Responsibility",`æ»¡å‡å¤„ç†å™¨: æ»¡${n}å‡${o}ï¼ŒæŠ˜æ‰£ Â¥${o}`)):r.log("Chain of Responsibility",`æ»¡å‡å¤„ç†å™¨: æœªè¾¾åˆ° Â¥${n}ï¼Œè·³è¿‡`)}}const Ft=Object.freeze(Object.defineProperty({__proto__:null,ThresholdDiscountHandler:et},Symbol.toStringTag,{value:"Module"}));class rt extends N{process(t){const o=v.getInstance().get("memberDiscounts")[t.memberLevel];if(o>0){const s=t.currentAmount*o;t.currentAmount-=s,t.discounts.push({name:`${t.memberLevel}ä¼šå‘˜æŠ˜æ‰£`,amount:s}),r.log("Chain of Responsibility",`ä¼šå‘˜å¤„ç†å™¨: ${t.memberLevel} ä¼šå‘˜ ${o*100}% æŠ˜æ‰£ï¼ŒÂ¥${s.toFixed(2)}`)}else r.log("Chain of Responsibility","ä¼šå‘˜å¤„ç†å™¨: éä¼šå‘˜ï¼Œè·³è¿‡")}}const Mt=Object.freeze(Object.defineProperty({__proto__:null,MemberDiscountHandler:rt},Symbol.toStringTag,{value:"Module"}));class nt extends N{process(t){const n=v.getInstance().get("weekendDiscount");if(t.isWeekend){const o=t.currentAmount*n;t.currentAmount-=o,t.discounts.push({name:"å‘¨æœ«æ´»åŠ¨æŠ˜æ‰£",amount:o}),r.log("Chain of Responsibility",`æ´»åŠ¨å¤„ç†å™¨: å‘¨æœ« ${n*100}% æŠ˜æ‰£ï¼ŒÂ¥${o.toFixed(2)}`)}else r.log("Chain of Responsibility","æ´»åŠ¨å¤„ç†å™¨: éå‘¨æœ«ï¼Œè·³è¿‡")}}const Nt=Object.freeze(Object.defineProperty({__proto__:null,CampaignDiscountHandler:nt},Symbol.toStringTag,{value:"Module"}));class ot{constructor(){i(this,"rate",.1)}getName(){return"æ—¥æœ¬æ¶ˆè´¹ç¨ (10%)"}calculate(t){const e=t*this.rate;return r.log("Strategy",`${this.getName()}: Â¥${t} Ã— 10% = Â¥${e.toFixed(2)}`),e}}const Vt=Object.freeze(Object.defineProperty({__proto__:null,JPTaxStrategy:ot},Symbol.toStringTag,{value:"Module"}));class st{constructor(){i(this,"fee",15)}getName(){return"æ ‡å‡†è¿è´¹"}calculate(t){return r.log("Strategy",`${this.getName()}: Â¥${this.fee}`),this.fee}}const qt=Object.freeze(Object.defineProperty({__proto__:null,StandardShippingStrategy:st},Symbol.toStringTag,{value:"Module"}));class it{constructor(){i(this,"fee",25)}getName(){return"å¿«é€’è¿è´¹"}calculate(t){return r.log("Strategy",`${this.getName()}: Â¥${this.fee}`),this.fee}}const jt=Object.freeze(Object.defineProperty({__proto__:null,ExpressShippingStrategy:it},Symbol.toStringTag,{value:"Module"}));class at{constructor(t){i(this,"threshold");i(this,"baseFee",15);this.threshold=t}getName(){return`æ»¡${this.threshold}å…è¿è´¹`}calculate(t){const e=t>=this.threshold?0:this.baseFee;return r.log("Strategy",`${this.getName()}: ${t>=this.threshold?"å…è¿è´¹":`Â¥${e}`}`),e}}const Ht=Object.freeze(Object.defineProperty({__proto__:null,FreeOverXShippingStrategy:at},Symbol.toStringTag,{value:"Module"}));class ct{calculate(t){r.log("Facade","=== å¼€å§‹ç»“ç®—è®¡ç®— ===");const e=t.items.reduce((h,d)=>h+d.price*d.quantity,0);r.log("Facade",`1. å•†å“å°è®¡: Â¥${e}`),r.log("Facade","2. å¤„ç†æŠ˜æ‰£é“¾...");const n=this.processDiscountChain(e,t),s=new ot().calculate(n.currentAmount);r.log("Facade",`3. ç¨è´¹è®¡ç®—: Â¥${s}`);const a=this.calculateShipping(t.shippingType,e);r.log("Facade",`4. è¿è´¹è®¡ç®—: Â¥${a}`);const u=n.currentAmount+s+a;return r.log("Facade",`5. è®¢å•æ€»è®¡: Â¥${u}`),r.log("Facade","=== ç»“ç®—è®¡ç®—å®Œæˆ ==="),{subtotal:e,discounts:n.discounts,tax:s,shipping:a,total:u}}processDiscountChain(t,e){const n=v.getInstance(),o=new tt,s=new et,a=new rt,u=new nt;o.setNext(s).setNext(a).setNext(u);const h={subtotal:t,currentAmount:t,couponCode:e.couponCode,memberLevel:e.memberLevel||"None",isWeekend:n.get("isWeekendMode"),discounts:[]};return o.handle(h),h}calculateShipping(t,e){switch(t){case"express":return new it().calculate(e);case"free":return new at(0).calculate(e);default:return new st().calculate(e)}}}const Bt=Object.freeze(Object.defineProperty({__proto__:null,CheckoutFacade:ct},Symbol.toStringTag,{value:"Module"}));class lt{constructor(t){i(this,"input");i(this,"position",0);this.input=t.trim()}tokenize(){const t=[];for(;this.position<this.input.length&&(this.skipWhitespace(),!(this.position>=this.input.length));){const e=this.nextToken();e&&t.push(e)}return t.push({type:"EOF",value:""}),t}skipWhitespace(){for(;this.position<this.input.length&&/\s/.test(this.input[this.position]);)this.position++}nextToken(){const t=this.input[this.position];if(/\d/.test(t))return this.readNumber();if(t==='"')return this.readString();if(t===">")return this.position++,this.input[this.position]==="="?(this.position++,{type:"GTE",value:">="}):{type:"GT",value:">"};if(t==="<")return this.position++,this.input[this.position]==="="?(this.position++,{type:"LTE",value:"<="}):{type:"LT",value:"<"};if(t==="="&&this.input[this.position+1]==="=")return this.position+=2,{type:"EQ",value:"=="};const e=this.readWord();if(e){const o={PERCENT:"PERCENT",MINUS:"MINUS",FREE_SHIP:"FREE_SHIP",IF:"IF",AND:"AND",OR:"OR",TOTAL:"TOTAL",CATEGORY:"CATEGORY",QUANTITY:"QUANTITY"}[e.toUpperCase()];if(o)return{type:o,value:e}}return this.position++,null}readNumber(){let t="";for(;this.position<this.input.length&&/[\d.]/.test(this.input[this.position]);)t+=this.input[this.position++];return{type:"NUMBER",value:parseFloat(t)}}readString(){this.position++;let t="";for(;this.position<this.input.length&&this.input[this.position]!=='"';)t+=this.input[this.position++];return this.position++,{type:"STRING",value:t}}readWord(){let t="";for(;this.position<this.input.length&&/[a-zA-Z_]/.test(this.input[this.position]);)t+=this.input[this.position++];return t}}const zt=Object.freeze(Object.defineProperty({__proto__:null,Tokenizer:lt},Symbol.toStringTag,{value:"Module"}));function Jt(l,t,e){return{type:"Rule",action:l,value:t,condition:e}}function Gt(l,t,e){return{type:"Condition",field:l,operator:t,literal:e}}class dt{constructor(t){i(this,"tokens");i(this,"position",0);this.tokens=t}parse(){return this.parseRule()}current(){return this.tokens[this.position]||{type:"EOF",value:""}}advance(){return this.tokens[this.position++]}expect(t){const e=this.advance();if(e.type!==t)throw new Error(`Expected ${t}, got ${e.type}`);return e}parseRule(){const e=this.advance().type;let n=0;e!=="FREE_SHIP"&&(n=this.expect("NUMBER").value);let o;return this.current().type==="IF"&&(this.advance(),o=this.parseCondition()),Jt(e,n,o)}parseCondition(){const e=this.advance().type,o=this.advance().value,a=this.advance().value;return Gt(e,o,a)}}const Qt=Object.freeze(Object.defineProperty({__proto__:null,Parser:dt},Symbol.toStringTag,{value:"Module"}));class ut{evaluate(t,e){if(t.type!=="Rule")throw new Error("Root node must be a Rule");if(t.condition&&!this.evalCondition(t.condition,e))return{applied:!1,discount:0,freeShipping:!1,message:"æ¡ä»¶ä¸æ»¡è¶³"};switch(t.action){case"PERCENT":const n=e.total*(t.value/100);return r.log("Interpreter",`åº”ç”¨ ${t.value}% æŠ˜æ‰£: -Â¥${n.toFixed(2)}`),{applied:!0,discount:n,freeShipping:!1,message:`${t.value}% æŠ˜æ‰£`};case"MINUS":return r.log("Interpreter",`åº”ç”¨å›ºå®šå‡å…: -Â¥${t.value}`),{applied:!0,discount:t.value,freeShipping:!1,message:`å‡ Â¥${t.value}`};case"FREE_SHIP":return r.log("Interpreter","åº”ç”¨å…è¿è´¹"),{applied:!0,discount:e.shipping||0,freeShipping:!0,message:"å…è¿è´¹"};default:return{applied:!1,discount:0,freeShipping:!1,message:"æœªçŸ¥åŠ¨ä½œ"}}}evalCondition(t,e){if(t.type==="BinaryOp"){const n=this.evalCondition(t.left,e),o=this.evalCondition(t.right,e);return t.operator==="AND"?n&&o:t.operator==="OR"?n||o:!1}if(t.type==="Condition"){const n=this.getFieldValue(t.field,e),o=t.literal;switch(t.operator){case">":return n>o;case"<":return n<o;case">=":return n>=o;case"<=":return n<=o;case"==":return n===o;default:return!1}}return!1}getFieldValue(t,e){switch(t){case"TOTAL":return e.total;case"CATEGORY":return e.category||"";case"QUANTITY":return e.quantity||0;default:return 0}}}const Ut=Object.freeze(Object.defineProperty({__proto__:null,Evaluator:ut},Symbol.toStringTag,{value:"Module"}));class F{constructor(t,e){i(this,"label");i(this,"amount");this.label=t,this.amount=e}getLabel(){return this.label}getAmount(){return this.amount}isLeaf(){return!0}print(t,e){const n="  ".repeat(t),o=(this.amount>=0,"");e(`${n}â”œâ”€ ${this.label}: ${o}Â¥${Math.abs(this.amount).toFixed(2)}`)}accept(t){t.visitLine(this)}}const J=Object.freeze(Object.defineProperty({__proto__:null,PriceLine:F},Symbol.toStringTag,{value:"Module"}));class pt{constructor(t){i(this,"label");i(this,"children",[]);this.label=t}getLabel(){return this.label}getAmount(){return this.children.reduce((t,e)=>t+e.getAmount(),0)}isLeaf(){return!1}add(t){this.children.push(t)}remove(t){const e=this.children.indexOf(t);e>-1&&this.children.splice(e,1)}getChildren(){return this.children}print(t,e){const n="  ".repeat(t);e(`${n}ğŸ“ ${this.label}`),this.children.forEach(o=>o.print(t+1,e))}accept(t){t.visitGroup(this),this.children.forEach(e=>e.accept(t)),t.visitGroupEnd(this)}}const G=Object.freeze(Object.defineProperty({__proto__:null,PriceGroup:pt},Symbol.toStringTag,{value:"Module"}));class ht{constructor(){i(this,"html","");i(this,"depth",0)}visitLine(t){const e="  ".repeat(this.depth),n=t.getAmount()<0?"discount":"normal";this.html+=`${e}<li class="${n}">${t.getLabel()}: Â¥${t.getAmount().toFixed(2)}</li>
`}visitGroup(t){const e="  ".repeat(this.depth);this.html+=`${e}<div class="price-group">
`,this.html+=`${e}  <h4>${t.getLabel()}</h4>
`,this.html+=`${e}  <ul>
`,this.depth++}visitGroupEnd(t){this.depth--;const e="  ".repeat(this.depth);this.html+=`${e}  </ul>
`,this.html+=`${e}  <strong>å°è®¡: Â¥${t.getAmount().toFixed(2)}</strong>
`,this.html+=`${e}</div>
`}getResult(){return this.html}}const Yt=Object.freeze(Object.defineProperty({__proto__:null,HtmlPricingVisitor:ht},Symbol.toStringTag,{value:"Module"}));class mt{constructor(){i(this,"stack",[[]])}visitLine(t){this.stack[this.stack.length-1].push({label:t.getLabel(),amount:t.getAmount(),type:"line"})}visitGroup(t){this.stack.push([])}visitGroupEnd(t){const e=this.stack.pop();this.stack[this.stack.length-1].push({label:t.getLabel(),amount:t.getAmount(),type:"group",children:e})}getResult(){return JSON.stringify(this.stack[0],null,2)}}const Wt=Object.freeze(Object.defineProperty({__proto__:null,JsonPricingVisitor:mt},Symbol.toStringTag,{value:"Module"}));class gt{constructor(){i(this,"text","");i(this,"depth",0)}visitLine(t){const e="  ".repeat(this.depth),n=t.getAmount()>=0?"+":"";this.text+=`${e}${t.getLabel()}: ${n}Â¥${t.getAmount().toFixed(2)}
`}visitGroup(t){const e="  ".repeat(this.depth);this.text+=`${e}[${t.getLabel()}]
`,this.depth++}visitGroupEnd(t){this.depth--;const e="  ".repeat(this.depth);this.text+=`${e}--- å°è®¡: Â¥${t.getAmount().toFixed(2)} ---
`}getResult(){return this.text}}const Kt=Object.freeze(Object.defineProperty({__proto__:null,TextPricingVisitor:gt},Symbol.toStringTag,{value:"Module"}));class Xt{constructor(){i(this,"caretaker");i(this,"couponPanel");this.caretaker=new Z(m.getInstance()),this.couponPanel=new Rt}render(){const t=document.createElement("div");return t.innerHTML=this.getTemplate(),t.querySelector("#cart-section").appendChild(new Lt().render()),t.querySelector("#coupon-section").appendChild(this.couponPanel.render()),this.bindEvents(t),t}getTemplate(){return`
      <h1 class="page-title">ğŸ’³ ç»“ç®—</h1>
      
      <div class="row">
        <div class="col" id="cart-section"></div>
        <div class="col" id="coupon-section"></div>
      </div>

      <div class="checkout-section">
        <h3>ç­–ç•¥é€‰æ‹© (Strategy æ¨¡å¼)</h3>
        <div class="strategy-selectors">
          <div class="form-group">
            <label class="form-label">ç¨ç­–ç•¥</label>
            <select id="tax-strategy" class="form-control">
              <option value="JP">æ—¥æœ¬æ¶ˆè´¹ç¨ (10%)</option>
              <option value="US">ç¾å›½é”€å”®ç¨ (8%)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">è¿è´¹ç­–ç•¥</label>
            <select id="shipping-strategy" class="form-control">
              <option value="standard">æ ‡å‡†è¿è´¹ (Â¥15)</option>
              <option value="express">å¿«é€’è¿è´¹ (Â¥25)</option>
              <option value="free">æ»¡200å…è¿è´¹</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ä¼šå‘˜ç­‰çº§</label>
            <select id="member-level" class="form-control">
              <option value="None">æ™®é€šç”¨æˆ·</option>
              <option value="Silver">é“¶å¡ä¼šå‘˜ (5%æŠ˜æ‰£)</option>
              <option value="Gold">é‡‘å¡ä¼šå‘˜ (10%æŠ˜æ‰£)</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="decorator-toggle">
            <input type="checkbox" id="weekend-mode" ${v.getInstance().get("isWeekendMode")?"checked":""}>
            æ¨¡æ‹Ÿå‘¨æœ«æ¨¡å¼ (æ´»åŠ¨æŠ˜æ‰£ 5%)
          </label>
        </div>
      </div>

      <div class="checkout-section">
        <h3>DSL ä¼˜æƒ è§„åˆ™ (Interpreter æ¨¡å¼)</h3>
        <div class="form-group">
          <textarea id="dsl-input" class="form-control dsl-input" placeholder="PERCENT 10 IF TOTAL > 200">PERCENT 10 IF TOTAL > 200</textarea>
        </div>
        <button id="btn-parse-dsl" class="btn btn-secondary">è§£æ DSL</button>
      </div>

      <div class="checkout-section">
        <h3>æ“ä½œ</h3>
        <div class="flex gap-1 flex-wrap">
          <button id="btn-undo" class="btn btn-secondary">â†© Undo</button>
          <button id="btn-redo" class="btn btn-secondary">â†ª Redo</button>
          <button id="btn-save-snapshot" class="btn btn-secondary">ğŸ“¸ ä¿å­˜å¿«ç…§</button>
          <button id="btn-restore-snapshot" class="btn btn-secondary">ğŸ”„ æ¢å¤å¿«ç…§</button>
          <button id="btn-calculate" class="btn btn-primary">ğŸ§® è®¡ç®—æ€»ä»·</button>
        </div>
      </div>

      <div class="checkout-section">
        <h3>ä»·æ ¼æ˜ç»†å¯¼å‡º (Visitor æ¨¡å¼)</h3>
        <div class="export-buttons">
          <button id="btn-export-html" class="btn btn-secondary">å¯¼å‡º HTML</button>
          <button id="btn-export-json" class="btn btn-secondary">å¯¼å‡º JSON</button>
          <button id="btn-export-text" class="btn btn-secondary">å¯¼å‡º Text</button>
        </div>
      </div>

      <div class="checkout-section">
        <h3>è®¡ç®—ç»“æœ</h3>
        <div id="pricing-result" class="pricing-tree"></div>
      </div>
    `}bindEvents(t){var s,a,u,h,d,c,g,L,y,b,f,H;const e=A.getInstance(),n=v.getInstance(),o=O.getInstance();(s=t.querySelector("#btn-undo"))==null||s.addEventListener("click",()=>e.undo()),(a=t.querySelector("#btn-redo"))==null||a.addEventListener("click",()=>e.redo()),(u=t.querySelector("#btn-save-snapshot"))==null||u.addEventListener("click",()=>{this.caretaker.save()}),(h=t.querySelector("#btn-restore-snapshot"))==null||h.addEventListener("click",()=>{this.caretaker.restore()}),(d=t.querySelector("#weekend-mode"))==null||d.addEventListener("change",_t=>{const B=_t.target.checked;n.set("isWeekendMode",B),r.log("Strategy",`å‘¨æœ«æ¨¡å¼: ${B?"å¼€å¯":"å…³é—­"}`)}),(c=t.querySelector("#tax-strategy"))==null||c.addEventListener("change",()=>{o.notify("StrategySelector","taxChanged",{})}),(g=t.querySelector("#shipping-strategy"))==null||g.addEventListener("change",()=>{o.notify("StrategySelector","shippingChanged",{})}),(L=t.querySelector("#btn-calculate"))==null||L.addEventListener("click",()=>{this.calculate(t)}),(y=t.querySelector("#btn-parse-dsl"))==null||y.addEventListener("click",()=>{this.parseDSL(t)}),(b=t.querySelector("#btn-export-html"))==null||b.addEventListener("click",()=>this.exportPricing("html")),(f=t.querySelector("#btn-export-json"))==null||f.addEventListener("click",()=>this.exportPricing("json")),(H=t.querySelector("#btn-export-text"))==null||H.addEventListener("click",()=>this.exportPricing("text"))}calculate(t){const n=m.getInstance().getItems().map(c=>({productId:c.product.id,name:c.product.name,price:c.product.price,quantity:c.quantity}));if(n.length===0){r.log("Facade","è´­ç‰©è½¦ä¸ºç©º");return}const o=t.querySelector("#member-level").value,s=t.querySelector("#shipping-strategy").value,a=this.couponPanel.getAppliedCoupon()||void 0,h=new ct().calculate({items:n,memberLevel:o,couponCode:a,shippingType:s}),d=t.querySelector("#pricing-result");d.innerHTML=`
      <div>å•†å“å°è®¡: Â¥${h.subtotal.toFixed(2)}</div>
      ${h.discounts.map(c=>`<div style="color: var(--success-color)">${c.name}: -Â¥${c.amount.toFixed(2)}</div>`).join("")}
      <div>ç¨è´¹: Â¥${h.tax.toFixed(2)}</div>
      <div>è¿è´¹: Â¥${h.shipping.toFixed(2)}</div>
      <div class="pricing-total">æ€»è®¡: Â¥${h.total.toFixed(2)}</div>
    `}parseDSL(t){const e=t.querySelector("#dsl-input").value;if(e.trim())try{const o=new lt(e).tokenize();r.log("Interpreter",`Tokens: ${o.map(c=>`${c.type}(${c.value})`).join(" ")}`);const a=new dt(o).parse();r.log("Interpreter",`AST: ${JSON.stringify(a)}`);const u=new ut,h={total:m.getInstance().getTotalAmount(),shipping:15},d=u.evaluate(a,h);r.log("Interpreter",`ç»“æœ: ${JSON.stringify(d)}`)}catch(n){r.log("Interpreter",`è§£æé”™è¯¯: ${n}`)}}exportPricing(t){const n=m.getInstance().getTotalAmount(),o=new pt("è®¢å•æ€»è®¡");o.add(new F("å•†å“å°è®¡",n)),o.add(new F("ç¨è´¹ (10%)",n*.1)),o.add(new F("è¿è´¹",15));let s;switch(t){case"html":s=new ht;break;case"json":s=new mt;break;case"text":s=new gt;break}o.accept(s),r.log("Visitor",`${t.toUpperCase()} å¯¼å‡º:
${s.getResult()}`)}}class Zt{constructor(t){}getName(){return"Shipped"}getAvailableActions(){return[]}place(){r.log("State","è®¢å•å·²å‘è´§ï¼Œä¸èƒ½é‡æ–°æäº¤")}pay(){r.log("State","è®¢å•å·²å‘è´§ï¼Œä¸éœ€è¦å†æ”¯ä»˜")}ship(){r.log("State","è®¢å•å·²ç»å‘è´§äº†")}cancel(){r.log("State","å·²å‘è´§è®¢å•ä¸èƒ½å–æ¶ˆ")}}class te{constructor(t){i(this,"order");this.order=t}getName(){return"Paid"}getAvailableActions(){return["ship"]}place(){r.log("State","è®¢å•å·²ç»æäº¤è¿‡äº†")}pay(){r.log("State","è®¢å•å·²ç»æ”¯ä»˜è¿‡äº†")}ship(){r.log("State","è®¢å•å·²å‘è´§"),this.order.setState(new Zt(this.order))}cancel(){r.log("State","å·²æ”¯ä»˜è®¢å•ä¸èƒ½å–æ¶ˆï¼Œè¯·ç”³è¯·é€€æ¬¾")}}class yt{constructor(t){}getName(){return"Cancelled"}getAvailableActions(){return[]}place(){r.log("State","å·²å–æ¶ˆè®¢å•ä¸èƒ½é‡æ–°æäº¤")}pay(){r.log("State","å·²å–æ¶ˆè®¢å•ä¸èƒ½æ”¯ä»˜")}ship(){r.log("State","å·²å–æ¶ˆè®¢å•ä¸èƒ½å‘è´§")}cancel(){r.log("State","è®¢å•å·²ç»å–æ¶ˆäº†")}}class ee{constructor(t){i(this,"order");this.order=t}getName(){return"Placed"}getAvailableActions(){return["pay","cancel"]}place(){r.log("State","è®¢å•å·²ç»æäº¤è¿‡äº†")}pay(){r.log("State","è®¢å•å·²æ”¯ä»˜"),this.order.setState(new te(this.order))}ship(){r.log("State","æœªæ”¯ä»˜ä¸èƒ½å‘è´§")}cancel(){r.log("State","è®¢å•å·²å–æ¶ˆ"),this.order.setState(new yt(this.order))}}class re{constructor(t){i(this,"order");this.order=t}getName(){return"Draft"}getAvailableActions(){return["place","cancel"]}place(){r.log("State","è®¢å•å·²æäº¤"),this.order.setState(new ee(this.order))}pay(){r.log("State","è‰ç¨¿çŠ¶æ€ä¸èƒ½æ”¯ä»˜ï¼Œè¯·å…ˆæäº¤è®¢å•")}ship(){r.log("State","è‰ç¨¿çŠ¶æ€ä¸èƒ½å‘è´§")}cancel(){r.log("State","è®¢å•å·²å–æ¶ˆ"),this.order.setState(new yt(this.order))}}class j{constructor(t,e,n){i(this,"id");i(this,"items");i(this,"total");i(this,"state");i(this,"createdAt");i(this,"observers",[]);this.id=t,this.items=e,this.total=n,this.createdAt=new Date,this.state=new re(this)}getId(){return this.id}getItems(){return this.items}getTotal(){return this.total}getCreatedAt(){return this.createdAt}setState(t){r.log("State",`è®¢å• ${this.id} çŠ¶æ€å˜æ›´: ${this.state.getName()} -> ${t.getName()}`),this.state=t,this.notifyObservers()}getStateName(){return this.state.getName()}getAvailableActions(){return this.state.getAvailableActions()}place(){this.state.place()}pay(){this.state.pay()}ship(){this.state.ship()}cancel(){this.state.cancel()}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(e=>e!==t)}notifyObservers(){this.observers.forEach(t=>t(this))}toJSON(){return{id:this.id,items:this.items,total:this.total,state:this.state.getName(),createdAt:this.createdAt.toISOString()}}}const ne=Object.freeze(Object.defineProperty({__proto__:null,Order:j},Symbol.toStringTag,{value:"Module"}));class Q{constructor(){i(this,"id","");i(this,"items",[]);i(this,"total",0)}setId(t){return this.id=t,r.log("Builder",`è®¾ç½®è®¢å•ID: ${t}`),this}addItem(t){return this.items.push(t),r.log("Builder",`æ·»åŠ è®¢å•é¡¹: ${t.name}`),this}setTotal(t){return this.total=t,r.log("Builder",`è®¾ç½®æ€»é‡‘é¢: Â¥${t}`),this}build(){return this.id||(this.id=`order_${Date.now()}`),r.log("Builder","è®¢å•æ„å»ºå®Œæˆ"),new j(this.id,this.items,this.total)}reset(){return this.id="",this.items=[],this.total=0,this}}class oe{constructor(){i(this,"container");i(this,"order",null);this.container=document.createElement("div"),this.container.className="card"}setOrder(t){this.order=t,this.order.subscribe(()=>this.update()),this.update()}render(){return this.order||(this.container.innerHTML="<p>æš‚æ— è®¢å•</p>"),this.container}update(){if(!this.order)return;const t=this.order.getStateName(),e=this.order.getAvailableActions();this.container.innerHTML=`
      <h3>è®¢å•è¯¦æƒ…</h3>
      <p><strong>è®¢å•å·:</strong> ${this.order.getId()}</p>
      <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${this.order.getCreatedAt().toLocaleString()}</p>
      <div class="order-status">
        <span class="status-badge status-${t.toLowerCase()}">${t}</span>
      </div>
      <h4>å•†å“åˆ—è¡¨</h4>
      <ul>
        ${this.order.getItems().map(n=>`
          <li>${n.name} Ã— ${n.quantity} = Â¥${(n.price*n.quantity).toFixed(2)}</li>
        `).join("")}
      </ul>
      <p class="pricing-total">æ€»è®¡: Â¥${this.order.getTotal().toFixed(2)}</p>
      <div class="order-actions">
        ${e.includes("place")?'<button class="btn btn-primary" data-action="place">æäº¤è®¢å•</button>':""}
        ${e.includes("pay")?'<button class="btn btn-success" data-action="pay">æ”¯ä»˜</button>':""}
        ${e.includes("ship")?'<button class="btn btn-primary" data-action="ship">å‘è´§</button>':""}
        ${e.includes("cancel")?'<button class="btn btn-danger" data-action="cancel">å–æ¶ˆ</button>':""}
      </div>
    `,this.bindEvents()}bindEvents(){this.container.querySelectorAll("[data-action]").forEach(t=>{t.addEventListener("click",e=>{const n=e.target.dataset.action;if(this.order&&n)switch(r.log("State",`ç”¨æˆ·ç‚¹å‡»: ${n}`),n){case"place":this.order.place();break;case"pay":this.order.pay();break;case"ship":this.order.ship();break;case"cancel":this.order.cancel();break}})})}}class se{constructor(){i(this,"storage",new Y);i(this,"ORDER_KEY","patternmart_order")}render(){var s,a;const t=document.createElement("div");t.innerHTML=`
      <h1 class="page-title">ğŸ“¦ è®¢å•ç®¡ç†</h1>
      <p class="mb-2">è®¢å•çŠ¶æ€æµè½¬æ¼”ç¤º State æ¨¡å¼</p>
      <div class="mb-2">
        <button id="btn-create-order" class="btn btn-primary">ä»è´­ç‰©è½¦åˆ›å»ºè®¢å•</button>
        <button id="btn-demo-order" class="btn btn-secondary">åˆ›å»ºæ¼”ç¤ºè®¢å•</button>
      </div>
      <div id="order-container"></div>
    `;const e=t.querySelector("#order-container"),n=new oe;e.appendChild(n.render());const o=this.loadOrder();return o&&n.setOrder(o),(s=t.querySelector("#btn-create-order"))==null||s.addEventListener("click",()=>{const u=this.createOrderFromCart();u&&(n.setOrder(u),this.saveOrder(u))}),(a=t.querySelector("#btn-demo-order"))==null||a.addEventListener("click",()=>{const u=this.createDemoOrder();n.setOrder(u),this.saveOrder(u)}),t}createOrderFromCart(){const e=m.getInstance().getItems();if(e.length===0)return r.log("Builder","è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•åˆ›å»ºè®¢å•"),null;const n=new Q;n.setId(`order_${Date.now()}`);let o=0;e.forEach(a=>{n.addItem({productId:a.product.id,name:a.product.name,price:a.product.price,quantity:a.quantity}),o+=a.product.price*a.quantity}),n.setTotal(o);const s=n.build();return r.log("Builder",`è®¢å•åˆ›å»ºæˆåŠŸ: ${s.getId()}`),s}createDemoOrder(){const e=new Q().setId(`demo_${Date.now()}`).addItem({productId:"p1",name:"æ¼”ç¤ºå•†å“A",price:100,quantity:2}).addItem({productId:"p2",name:"æ¼”ç¤ºå•†å“B",price:50,quantity:1}).setTotal(250).build();return r.log("Builder",`æ¼”ç¤ºè®¢å•åˆ›å»ºæˆåŠŸ: ${e.getId()}`),e}saveOrder(t){this.storage.set(this.ORDER_KEY,JSON.stringify(t.toJSON()))}loadOrder(){const t=this.storage.get(this.ORDER_KEY);if(!t)return null;try{const e=JSON.parse(t);return new j(e.id,e.items,e.total)}catch{return null}}}const ie="modulepreload",ae=function(l,t){return new URL(l,t).href},U={},p=function(t,e,n){let o=Promise.resolve();if(e&&e.length>0){const a=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));o=Promise.allSettled(e.map(d=>{if(d=ae(d,n),d in U)return;U[d]=!0;const c=d.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(!!n)for(let b=a.length-1;b>=0;b--){const f=a[b];if(f.href===d&&(!c||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${g}`))return;const y=document.createElement("link");if(y.rel=c?"stylesheet":ie,c||(y.as="script"),y.crossOrigin="",y.href=d,h&&y.setAttribute("nonce",h),document.head.appendChild(y),c)return new Promise((b,f)=>{y.addEventListener("load",b),y.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return o.then(a=>{for(const u of a||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})},I=class I{constructor(){i(this,"instanceId");i(this,"level","info");this.instanceId=`logger_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static getInstance(){return I.instance||(I.instance=new I),I.instance}getInstanceId(){return this.instanceId}setLevel(t){this.level=t}formatTime(){return new Date().toTimeString().split(" ")[0]}debug(t,e){this.shouldLog("debug")&&console.debug(`[${this.formatTime()}][DEBUG][${t}] ${e}`)}info(t,e){this.shouldLog("info")&&console.info(`[${this.formatTime()}][INFO][${t}] ${e}`)}warn(t,e){this.shouldLog("warn")&&console.warn(`[${this.formatTime()}][WARN][${t}] ${e}`)}error(t,e){this.shouldLog("error")&&console.error(`[${this.formatTime()}][ERROR][${t}] ${e}`)}shouldLog(t){const e=["debug","info","warn","error"];return e.indexOf(t)>=e.indexOf(this.level)}};i(I,"instance",null);let k=I;const P=class P{constructor(){i(this,"demos",new Map)}static getInstance(){return P.instance||(P.instance=new P),P.instance}registerAll(){this.registerCreationalPatterns(),this.registerStructuralPatterns(),this.registerBehavioralPatterns()}getAll(){return Array.from(this.demos.values())}runDemo(t){const e=this.demos.get(t);e&&e.run()}registerCreationalPatterns(){this.demos.set("Singleton",{name:"Singleton",type:"creational",description:"ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹",file:"src/app/config/AppConfig.ts",run:()=>{const t=v.getInstance(),e=v.getInstance(),n=k.getInstance(),o=k.getInstance();r.log("Singleton","=== Singleton æ¨¡å¼æ¼”ç¤º ==="),r.log("Singleton",`AppConfig å®ä¾‹1 ID: ${t.getInstanceId()}`),r.log("Singleton",`AppConfig å®ä¾‹2 ID: ${e.getInstanceId()}`),r.log("Singleton",`ä¸¤æ¬¡è·å–æ˜¯å¦ç›¸åŒ: ${t===e}`),r.log("Singleton",`Logger å®ä¾‹1 ID: ${n.getInstanceId()}`),r.log("Singleton",`Logger å®ä¾‹2 ID: ${o.getInstanceId()}`),r.log("Singleton",`Logger ä¸¤æ¬¡è·å–æ˜¯å¦ç›¸åŒ: ${n===o}`)}}),this.demos.set("Factory Method",{name:"Factory Method",type:"creational",description:"å®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»",file:"src/domain/coupon/factory/CouponHandlerFactory.ts",run:async()=>{const{CouponHandlerFactory:t}=await p(async()=>{const{CouponHandlerFactory:n}=await import("./CouponHandlerFactory-e4nkI2zt.js");return{CouponHandlerFactory:n}},[],import.meta.url);r.log("Factory Method","=== Factory Method æ¨¡å¼æ¼”ç¤º ===");const e=["percent","fixed","freeShip"];for(const n of e){const o=t.create(n);r.log("Factory Method",`åˆ›å»ºç±»å‹ "${n}" -> ${o.getName()}`)}}}),this.demos.set("Abstract Factory",{name:"Abstract Factory",type:"creational",description:"æä¾›åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³å¯¹è±¡çš„æ¥å£ï¼Œæ— éœ€æŒ‡å®šå…·ä½“ç±»",file:"src/domain/ui/theme/IThemeFactory.ts",run:async()=>{const{LightThemeFactory:t}=await p(async()=>{const{LightThemeFactory:s}=await Promise.resolve().then(()=>ue);return{LightThemeFactory:s}},void 0,import.meta.url),{DarkThemeFactory:e}=await p(async()=>{const{DarkThemeFactory:s}=await Promise.resolve().then(()=>me);return{DarkThemeFactory:s}},void 0,import.meta.url),{RetroThemeFactory:n}=await p(async()=>{const{RetroThemeFactory:s}=await Promise.resolve().then(()=>ve);return{RetroThemeFactory:s}},void 0,import.meta.url);r.log("Abstract Factory","=== Abstract Factory æ¨¡å¼æ¼”ç¤º ===");const o=[new t,new e,new n];for(const s of o){const a=s.createButton(),u=s.createCard();r.log("Abstract Factory",`${s.constructor.name}:`),r.log("Abstract Factory",`  æŒ‰é’®æ ·å¼: ${a.getClassName()}`),r.log("Abstract Factory",`  å¡ç‰‡æ ·å¼: ${u.getClassName()}`)}}}),this.demos.set("Builder",{name:"Builder",type:"creational",description:"å°†å¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»",file:"src/domain/checkout/request/CheckoutRequestBuilder.ts",run:async()=>{const{CheckoutRequestBuilder:t}=await p(async()=>{const{CheckoutRequestBuilder:o}=await import("./CheckoutRequestBuilder-N5Rqubk2.js");return{CheckoutRequestBuilder:o}},[],import.meta.url);r.log("Builder","=== Builder æ¨¡å¼æ¼”ç¤º ==="),r.log("Builder","å¼€å§‹æ„å»º CheckoutRequest...");const n=new t().setCustomerId("user_123").setMemberLevel("Gold").addItem({productId:"p1",name:"å•†å“A",price:100,quantity:2}).addItem({productId:"p2",name:"å•†å“B",price:50,quantity:1}).setCouponCode("SAVE10").setTaxStrategy("JP").setShippingStrategy("express").build();r.log("Builder",`æ„å»ºå®Œæˆ: ${JSON.stringify(n,null,2)}`)}}),this.demos.set("Prototype",{name:"Prototype",type:"creational",description:"é€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡",file:"src/domain/coupon/prototype/CouponTemplate.ts",run:async()=>{const{CouponTemplate:t}=await p(async()=>{const{CouponTemplate:s}=await import("./CouponTemplate-CKCUAZvt.js");return{CouponTemplate:s}},[],import.meta.url);r.log("Prototype","=== Prototype æ¨¡å¼æ¼”ç¤º ===");const e=new t("TEMPLATE","percent",10,{minAmount:100});r.log("Prototype",`åŸå§‹æ¨¡æ¿: ${JSON.stringify(e.toJSON())}`);const n=e.clone();n.setCode("CLONE_001");const o=e.clone();o.setCode("CLONE_002"),o.setValue(15),r.log("Prototype",`å…‹éš†1: ${JSON.stringify(n.toJSON())}`),r.log("Prototype",`å…‹éš†2: ${JSON.stringify(o.toJSON())}`),r.log("Prototype",`åŸå§‹æ¨¡æ¿æ˜¯å¦è¢«ä¿®æ”¹: ${e.getCode()==="TEMPLATE"}`),r.log("Prototype",`å…‹éš†å¯¹è±¡å¼•ç”¨ä¸åŒ: ${n!==o&&n!==e}`)}})}registerStructuralPatterns(){this.demos.set("Adapter",{name:"Adapter",type:"structural",description:"å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£",file:"src/domain/coupon/provider/CouponProviderAdapter.ts",run:async()=>{const{CouponProviderAdapter:t}=await p(async()=>{const{CouponProviderAdapter:c}=await import("./CouponProviderAdapter-BqMiv_Mm.js");return{CouponProviderAdapter:c}},__vite__mapDeps([0,1]),import.meta.url),{LocalJsonCouponProvider:e}=await p(async()=>{const{LocalJsonCouponProvider:c}=await import("./LocalJsonCouponProvider-BF4-LJGx.js");return{LocalJsonCouponProvider:c}},[],import.meta.url),{RemoteMockCouponProvider:n}=await p(async()=>{const{RemoteMockCouponProvider:c}=await import("./RemoteMockCouponProvider-5varbeyq.js");return{RemoteMockCouponProvider:c}},[],import.meta.url);r.log("Adapter","=== Adapter æ¨¡å¼æ¼”ç¤º ===");const o=new e,s=new n,a=new t(o),u=new t(s);r.log("Adapter","æœ¬åœ°æ•°æ®æºï¼ˆåŸå§‹æ ¼å¼ä¸åŒï¼‰:"),(await a.getCoupons()).forEach(c=>r.log("Adapter",`  - ${c.code}: ${c.description}`)),r.log("Adapter","è¿œç¨‹æ•°æ®æºï¼ˆåŸå§‹æ ¼å¼ä¸åŒï¼‰:"),(await u.getCoupons()).forEach(c=>r.log("Adapter",`  - ${c.code}: ${c.description}`)),r.log("Adapter","é€‚é…åæ¥å£ç»Ÿä¸€ï¼Œè°ƒç”¨æ–¹å¼ç›¸åŒï¼")}}),this.demos.set("Bridge",{name:"Bridge",type:"structural",description:"å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–",file:"src/domain/ui/renderer/IRenderer.ts",run:async()=>{const{DomRenderer:t}=await p(async()=>{const{DomRenderer:d}=await import("./DomRenderer-CFCd4bMr.js");return{DomRenderer:d}},[],import.meta.url),{ConsoleRenderer:e}=await p(async()=>{const{ConsoleRenderer:d}=await import("./ConsoleRenderer-D2tZfdbl.js");return{ConsoleRenderer:d}},[],import.meta.url),{PricingTreeView:n}=await p(async()=>{const{PricingTreeView:d}=await import("./PricingTreeView-CpTwKXOd.js");return{PricingTreeView:d}},[],import.meta.url);r.log("Bridge","=== Bridge æ¨¡å¼æ¼”ç¤º ===");const o={label:"è®¢å•æ€»è®¡",children:[{label:"å•†å“å°è®¡: Â¥200"},{label:"æŠ˜æ‰£: -Â¥30"},{label:"ç¨è´¹: Â¥17"},{label:"è¿è´¹: Â¥10"}]};r.log("Bridge","ä½¿ç”¨ DomRenderer æ¸²æŸ“:");const s=new t;new n(s).renderToConsole(o),r.log("Bridge","ä½¿ç”¨ ConsoleRenderer æ¸²æŸ“:");const u=new e;new n(u).renderToConsole(o),r.log("Bridge","åŒä¸€æŠ½è±¡ï¼ˆPricingTreeViewï¼‰å¯ä½¿ç”¨ä¸åŒå®ç°ï¼ˆRendererï¼‰")}}),this.demos.set("Composite",{name:"Composite",type:"structural",description:'å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"å±‚æ¬¡',file:"src/domain/pricing/tree/PricingNode.ts",run:async()=>{const{PriceLine:t}=await p(async()=>{const{PriceLine:c}=await Promise.resolve().then(()=>J);return{PriceLine:c}},void 0,import.meta.url),{PriceGroup:e}=await p(async()=>{const{PriceGroup:c}=await Promise.resolve().then(()=>G);return{PriceGroup:c}},void 0,import.meta.url);r.log("Composite","=== Composite æ¨¡å¼æ¼”ç¤º ===");const n=new t("å•†å“å°è®¡",500),o=new t("ä¼˜æƒ åˆ¸æŠ˜æ‰£",-50),s=new t("ä¼šå‘˜æŠ˜æ‰£",-25),a=new e("æŠ˜æ‰£æ˜ç»†");a.add(o),a.add(s);const u=new t("ç¨è´¹(10%)",42.5),h=new t("è¿è´¹",0),d=new e("è®¢å•æ€»è®¡");d.add(n),d.add(a),d.add(u),d.add(h),r.log("Composite","ä»·æ ¼æ ‘ç»“æ„:"),d.print(0,c=>r.log("Composite",c)),r.log("Composite",`æ€»é‡‘é¢: Â¥${d.getAmount()}`)}}),this.demos.set("Decorator",{name:"Decorator",type:"structural",description:"åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ é¢å¤–çš„èŒè´£",file:"src/domain/checkout/decorator/LoggingDecorator.ts",run:async()=>{const{CheckoutPipeline:t}=await p(async()=>{const{CheckoutPipeline:d}=await import("./CheckoutPipeline-DhzDqX0E.js");return{CheckoutPipeline:d}},[],import.meta.url),{LoggingDecorator:e}=await p(async()=>{const{LoggingDecorator:d}=await import("./LoggingDecorator-DiH_Zi8V.js");return{LoggingDecorator:d}},[],import.meta.url),{TimingDecorator:n}=await p(async()=>{const{TimingDecorator:d}=await import("./TimingDecorator-D7VikxIS.js");return{TimingDecorator:d}},[],import.meta.url),{CachingDecorator:o}=await p(async()=>{const{CachingDecorator:d}=await import("./CachingDecorator-CReisKYv.js");return{CachingDecorator:d}},[],import.meta.url);r.log("Decorator","=== Decorator æ¨¡å¼æ¼”ç¤º ===");const s=new t;r.log("Decorator","1. æ— è£…é¥°å™¨æ‰§è¡Œ:"),s.run({items:[{price:100,quantity:2}]}),r.log("Decorator","2. æ·»åŠ  LoggingDecorator:"),new e(new t).run({items:[{price:100,quantity:2}]}),r.log("Decorator","3. æ·»åŠ  TimingDecorator:"),new n(new t).run({items:[{price:100,quantity:2}]}),r.log("Decorator","4. ç»„åˆå¤šä¸ªè£…é¥°å™¨:");const h=new o(new n(new e(new t)));h.run({items:[{price:100,quantity:2}]}),r.log("Decorator","å†æ¬¡æ‰§è¡Œï¼ˆæµ‹è¯•ç¼“å­˜ï¼‰:"),h.run({items:[{price:100,quantity:2}]})}}),this.demos.set("Facade",{name:"Facade",type:"structural",description:"ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ç»Ÿä¸€çš„é«˜å±‚æ¥å£",file:"src/domain/checkout/facade/CheckoutFacade.ts",run:async()=>{const{CheckoutFacade:t}=await p(async()=>{const{CheckoutFacade:o}=await Promise.resolve().then(()=>Bt);return{CheckoutFacade:o}},void 0,import.meta.url);r.log("Facade","=== Facade æ¨¡å¼æ¼”ç¤º ==="),r.log("Facade","CheckoutFacade å°è£…äº†å¤æ‚çš„ç»“ç®—æµç¨‹:"),r.log("Facade","  - ä»·æ ¼è®¡ç®—"),r.log("Facade","  - æŠ˜æ‰£é“¾å¤„ç†"),r.log("Facade","  - ç¨è´¹è®¡ç®—"),r.log("Facade","  - è¿è´¹è®¡ç®—");const n=new t().calculate({items:[{productId:"p1",name:"å•†å“A",price:150,quantity:2},{productId:"p2",name:"å•†å“B",price:80,quantity:1}],memberLevel:"Gold",couponCode:"SAVE10"});r.log("Facade",`ç»“ç®—ç»“æœ: ${JSON.stringify(n,null,2)}`),r.log("Facade","UI åªéœ€è°ƒç”¨ facade.calculate()ï¼Œæ— éœ€äº†è§£å†…éƒ¨ç»†èŠ‚")}}),this.demos.set("Flyweight",{name:"Flyweight",type:"structural",description:"è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡",file:"src/domain/pricing/money/MoneyFormatterPool.ts",run:async()=>{const{MoneyFormatterPool:t}=await p(async()=>{const{MoneyFormatterPool:h}=await import("./MoneyFormatterPool-NKhNOW5L.js");return{MoneyFormatterPool:h}},[],import.meta.url);r.log("Flyweight","=== Flyweight æ¨¡å¼æ¼”ç¤º ===");const e=t.getInstance();r.log("Flyweight","è·å–æ ¼å¼åŒ–å™¨ï¼ˆé¦–æ¬¡åˆ›å»ºï¼‰:");const n=e.getFormatter("zh-CN","CNY");r.log("Flyweight",`  zh-CN/CNY: ${n.format(1234.56)}`);const o=e.getFormatter("en-US","USD");r.log("Flyweight",`  en-US/USD: ${o.format(1234.56)}`);const s=e.getFormatter("ja-JP","JPY");r.log("Flyweight",`  ja-JP/JPY: ${s.format(1234)}`),r.log("Flyweight","å†æ¬¡è·å–ï¼ˆå¤ç”¨å·²æœ‰å®ä¾‹ï¼‰:");const a=e.getFormatter("zh-CN","CNY");r.log("Flyweight",`  zh-CN/CNY æ˜¯å¦å¤ç”¨: ${n===a}`);const u=e.getStats();r.log("Flyweight",`æ± ç»Ÿè®¡: å®ä¾‹æ•°=${u.size}, å‘½ä¸­ç‡=${(u.hitRate*100).toFixed(1)}%`)}}),this.demos.set("Proxy",{name:"Proxy",type:"structural",description:"ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®",file:"src/domain/coupon/proxy/CouponValidatorProxy.ts",run:async()=>{const{CouponValidatorProxy:t}=await p(async()=>{const{CouponValidatorProxy:a}=await Promise.resolve().then(()=>kt);return{CouponValidatorProxy:a}},void 0,import.meta.url);r.log("Proxy","=== Proxy æ¨¡å¼æ¼”ç¤º ===");const e=new t;r.log("Proxy","é¦–æ¬¡éªŒè¯ä¼˜æƒ åˆ¸ï¼ˆè§¦å‘å®é™…æ ¡éªŒï¼‰:");const n=await e.validate("SAVE10",200);r.log("Proxy",`  ç»“æœ: ${n.valid?"æœ‰æ•ˆ":"æ— æ•ˆ"} - ${n.message}`),r.log("Proxy","å†æ¬¡éªŒè¯åŒä¸€ä¼˜æƒ åˆ¸ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰:");const o=await e.validate("SAVE10",200);r.log("Proxy",`  ç»“æœ: ${o.valid?"æœ‰æ•ˆ":"æ— æ•ˆ"} - ${o.message}`),r.log("Proxy","éªŒè¯æ— æ•ˆä¼˜æƒ åˆ¸:");const s=await e.validate("INVALID",100);r.log("Proxy",`  ç»“æœ: ${s.valid?"æœ‰æ•ˆ":"æ— æ•ˆ"} - ${s.message}`)}})}registerBehavioralPatterns(){this.demos.set("Strategy",{name:"Strategy",type:"behavioral",description:"å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬å°è£…èµ·æ¥ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢",file:"src/domain/checkout/strategies/ITaxStrategy.ts",run:async()=>{const{JPTaxStrategy:t}=await p(async()=>{const{JPTaxStrategy:c}=await Promise.resolve().then(()=>Vt);return{JPTaxStrategy:c}},void 0,import.meta.url),{StandardShippingStrategy:e}=await p(async()=>{const{StandardShippingStrategy:c}=await Promise.resolve().then(()=>qt);return{StandardShippingStrategy:c}},void 0,import.meta.url),{ExpressShippingStrategy:n}=await p(async()=>{const{ExpressShippingStrategy:c}=await Promise.resolve().then(()=>jt);return{ExpressShippingStrategy:c}},void 0,import.meta.url),{FreeOverXShippingStrategy:o}=await p(async()=>{const{FreeOverXShippingStrategy:c}=await Promise.resolve().then(()=>Ht);return{FreeOverXShippingStrategy:c}},void 0,import.meta.url);r.log("Strategy","=== Strategy æ¨¡å¼æ¼”ç¤º ===");const s=250;r.log("Strategy",`å•†å“å°è®¡: Â¥${s}`);const a=new t;r.log("Strategy",`æ—¥æœ¬æ¶ˆè´¹ç¨(10%): Â¥${a.calculate(s)}`);const u=new e,h=new n,d=new o(200);r.log("Strategy",`æ ‡å‡†è¿è´¹: Â¥${u.calculate(s)}`),r.log("Strategy",`å¿«é€’è¿è´¹: Â¥${h.calculate(s)}`),r.log("Strategy",`æ»¡200å…è¿è´¹: Â¥${d.calculate(s)}`),r.log("Strategy","ç­–ç•¥å¯åœ¨è¿è¡Œæ—¶åˆ‡æ¢ï¼Œç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯")}}),this.demos.set("Chain of Responsibility",{name:"Chain of Responsibility",type:"behavioral",description:"ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œå°†å¯¹è±¡è¿æˆé“¾",file:"src/domain/checkout/chain/DiscountHandler.ts",run:async()=>{const{CouponDiscountHandler:t}=await p(async()=>{const{CouponDiscountHandler:c}=await Promise.resolve().then(()=>xt);return{CouponDiscountHandler:c}},void 0,import.meta.url),{ThresholdDiscountHandler:e}=await p(async()=>{const{ThresholdDiscountHandler:c}=await Promise.resolve().then(()=>Ft);return{ThresholdDiscountHandler:c}},void 0,import.meta.url),{MemberDiscountHandler:n}=await p(async()=>{const{MemberDiscountHandler:c}=await Promise.resolve().then(()=>Mt);return{MemberDiscountHandler:c}},void 0,import.meta.url),{CampaignDiscountHandler:o}=await p(async()=>{const{CampaignDiscountHandler:c}=await Promise.resolve().then(()=>Nt);return{CampaignDiscountHandler:c}},void 0,import.meta.url);r.log("Chain of Responsibility","=== Chain of Responsibility æ¨¡å¼æ¼”ç¤º ===");const s=new t,a=new e,u=new n,h=new o;s.setNext(a).setNext(u).setNext(h);const d={subtotal:300,currentAmount:300,couponCode:"SAVE10",memberLevel:"Gold",isWeekend:!0,discounts:[]};r.log("Chain of Responsibility",`åˆå§‹é‡‘é¢: Â¥${d.subtotal}`),r.log("Chain of Responsibility","å¼€å§‹å¤„ç†æŠ˜æ‰£é“¾..."),s.handle(d),r.log("Chain of Responsibility","æŠ˜æ‰£æ˜ç»†:"),d.discounts.forEach(c=>{r.log("Chain of Responsibility",`  ${c.name}: -Â¥${c.amount}`)}),r.log("Chain of Responsibility",`æœ€ç»ˆé‡‘é¢: Â¥${d.currentAmount}`)}}),this.demos.set("Command",{name:"Command",type:"behavioral",description:"å°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œæ”¯æŒæ’¤é”€æ“ä½œ",file:"src/domain/cart/command/ICommand.ts",run:async()=>{var h,d,c;const{Cart:t}=await p(async()=>{const{Cart:g}=await Promise.resolve().then(()=>x);return{Cart:g}},void 0,import.meta.url),{CommandManager:e}=await p(async()=>{const{CommandManager:g}=await Promise.resolve().then(()=>It);return{CommandManager:g}},void 0,import.meta.url),{AddItemCommand:n}=await p(async()=>{const{AddItemCommand:g}=await Promise.resolve().then(()=>Pt);return{AddItemCommand:g}},void 0,import.meta.url),{SetQtyCommand:o}=await p(async()=>{const{SetQtyCommand:g}=await Promise.resolve().then(()=>Et);return{SetQtyCommand:g}},void 0,import.meta.url);r.log("Command","=== Command æ¨¡å¼æ¼”ç¤º ===");const s=t.getInstance();s.clear();const a=e.getInstance();a.clear();const u={id:"demo_p1",name:"æ¼”ç¤ºå•†å“",price:100,category:"Tech"};r.log("Command","æ‰§è¡Œ: æ·»åŠ å•†å“"),a.execute(new n(s,u,2)),r.log("Command",`è´­ç‰©è½¦: ${s.getItems().length} ç§å•†å“`),r.log("Command","æ‰§è¡Œ: ä¿®æ”¹æ•°é‡ä¸º 5"),a.execute(new o(s,"demo_p1",5)),r.log("Command",`æ•°é‡: ${(h=s.getItems()[0])==null?void 0:h.quantity}`),r.log("Command","æ’¤é”€ä¸Šä¸€æ­¥"),a.undo(),r.log("Command",`æ•°é‡: ${(d=s.getItems()[0])==null?void 0:d.quantity}`),r.log("Command","é‡åš"),a.redo(),r.log("Command",`æ•°é‡: ${(c=s.getItems()[0])==null?void 0:c.quantity}`),s.clear()}}),this.demos.set("Observer",{name:"Observer",type:"behavioral",description:"å®šä¹‰å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼ŒçŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰ä¾èµ–è€…",file:"src/domain/cart/Cart.ts",run:async()=>{const{Cart:t}=await p(async()=>{const{Cart:s}=await Promise.resolve().then(()=>x);return{Cart:s}},void 0,import.meta.url);r.log("Observer","=== Observer æ¨¡å¼æ¼”ç¤º ===");const e=t.getInstance();e.clear();const n=()=>r.log("Observer","  [è§‚å¯Ÿè€…1] è´­ç‰©è½¦å·²æ›´æ–°ï¼"),o=()=>r.log("Observer","  [è§‚å¯Ÿè€…2] éœ€è¦é‡æ–°è®¡ç®—ä»·æ ¼ï¼");e.subscribe(n),e.subscribe(o),r.log("Observer","æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦:"),e.addItem({id:"obs_p1",name:"è§‚å¯Ÿè€…æµ‹è¯•å•†å“",price:50,category:"Book"},1),r.log("Observer","ä¿®æ”¹å•†å“æ•°é‡:"),e.updateQuantity("obs_p1",3),r.log("Observer","ç§»é™¤è§‚å¯Ÿè€…1åå†æ¬¡ä¿®æ”¹:"),e.unsubscribe(n),e.updateQuantity("obs_p1",5),e.clear(),e.unsubscribe(o)}}),this.demos.set("Iterator",{name:"Iterator",type:"behavioral",description:"æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤º",file:"src/domain/cart/iterator/CartIterator.ts",run:async()=>{const{Cart:t}=await p(async()=>{const{Cart:a}=await Promise.resolve().then(()=>x);return{Cart:a}},void 0,import.meta.url),{CartIterator:e}=await p(async()=>{const{CartIterator:a}=await import("./CartIterator-C5xPWbGA.js");return{CartIterator:a}},[],import.meta.url);r.log("Iterator","=== Iterator æ¨¡å¼æ¼”ç¤º ===");const n=t.getInstance();n.clear(),n.addItem({id:"it_p1",name:"å•†å“A",price:100,category:"Tech"},2),n.addItem({id:"it_p2",name:"å•†å“B",price:50,category:"Book"},3),n.addItem({id:"it_p3",name:"å•†å“C",price:30,category:"Food"},1),r.log("Iterator","ä½¿ç”¨è¿­ä»£å™¨éå†è´­ç‰©è½¦:");const o=new e(n.getItems());let s=1;for(;o.hasNext();){const a=o.next();r.log("Iterator",`  ${s++}. ${a.product.name} x${a.quantity} = Â¥${a.product.price*a.quantity}`)}r.log("Iterator","è¿­ä»£å™¨éšè—äº†å†…éƒ¨æ•°æ®ç»“æ„ï¼Œæä¾›ç»Ÿä¸€çš„éå†æ¥å£"),n.clear()}}),this.demos.set("Mediator",{name:"Mediator",type:"behavioral",description:"ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡å°è£…ä¸€ç³»åˆ—å¯¹è±¡äº¤äº’",file:"src/domain/ui/mediator/CheckoutMediator.ts",run:async()=>{const{CheckoutMediator:t}=await p(async()=>{const{CheckoutMediator:n}=await Promise.resolve().then(()=>Ot);return{CheckoutMediator:n}},void 0,import.meta.url);r.log("Mediator","=== Mediator æ¨¡å¼æ¼”ç¤º ===");const e=t.getInstance();r.log("Mediator","ç»„ä»¶é€šè¿‡ä¸­ä»‹è€…é€šä¿¡ï¼Œè€Œéç›´æ¥è°ƒç”¨:"),r.log("Mediator","1. CouponPanel è¾“å…¥ä¼˜æƒ åˆ¸ç :"),e.notify("CouponPanel","couponApplied",{code:"SAVE10"}),r.log("Mediator","2. CartPanel æ›´æ–°å•†å“æ•°é‡:"),e.notify("CartPanel","quantityChanged",{productId:"p1",quantity:3}),r.log("Mediator","3. StrategySelector åˆ‡æ¢è¿è´¹ç­–ç•¥:"),e.notify("StrategySelector","shippingChanged",{strategy:"express"}),r.log("Mediator","ä¸­ä»‹è€…åè°ƒå„ç»„ä»¶ï¼Œé™ä½è€¦åˆåº¦")}}),this.demos.set("Memento",{name:"Memento",type:"behavioral",description:"åœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å¹¶ä¿å­˜",file:"src/domain/cart/memento/CartMemento.ts",run:async()=>{const{Cart:t}=await p(async()=>{const{Cart:s}=await Promise.resolve().then(()=>x);return{Cart:s}},void 0,import.meta.url),{CartCaretaker:e}=await p(async()=>{const{CartCaretaker:s}=await Promise.resolve().then(()=>Dt);return{CartCaretaker:s}},void 0,import.meta.url);r.log("Memento","=== Memento æ¨¡å¼æ¼”ç¤º ===");const n=t.getInstance(),o=new e(n);n.clear(),n.addItem({id:"mem_p1",name:"å•†å“A",price:100,category:"Tech"},2),r.log("Memento",`å½“å‰è´­ç‰©è½¦: ${n.getItems().length} ç§å•†å“, æ•°é‡: ${n.getTotalQuantity()}`),r.log("Memento","ä¿å­˜å¿«ç…§..."),o.save(),n.addItem({id:"mem_p2",name:"å•†å“B",price:50,category:"Book"},3),n.updateQuantity("mem_p1",5),r.log("Memento",`ä¿®æ”¹å: ${n.getItems().length} ç§å•†å“, æ•°é‡: ${n.getTotalQuantity()}`),r.log("Memento","æ¢å¤å¿«ç…§..."),o.restore(),r.log("Memento",`æ¢å¤å: ${n.getItems().length} ç§å•†å“, æ•°é‡: ${n.getTotalQuantity()}`),n.clear()}}),this.demos.set("State",{name:"State",type:"behavioral",description:"å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸º",file:"src/domain/order/state/OrderState.ts",run:async()=>{const{Order:t}=await p(async()=>{const{Order:n}=await Promise.resolve().then(()=>ne);return{Order:n}},void 0,import.meta.url);r.log("State","=== State æ¨¡å¼æ¼”ç¤º ===");const e=new t("order_demo_001",[{productId:"p1",name:"å•†å“A",price:100,quantity:2}],200);r.log("State",`åˆå§‹çŠ¶æ€: ${e.getStateName()}`),r.log("State",`å¯ç”¨æ“ä½œ: ${e.getAvailableActions().join(", ")}`),r.log("State","æ‰§è¡Œ: place()"),e.place(),r.log("State",`å½“å‰çŠ¶æ€: ${e.getStateName()}`),r.log("State","æ‰§è¡Œ: pay()"),e.pay(),r.log("State",`å½“å‰çŠ¶æ€: ${e.getStateName()}`),r.log("State","æ‰§è¡Œ: ship()"),e.ship(),r.log("State",`å½“å‰çŠ¶æ€: ${e.getStateName()}`),r.log("State","å°è¯•å–æ¶ˆå·²å‘è´§è®¢å•:"),e.cancel(),r.log("State",`å½“å‰çŠ¶æ€: ${e.getStateName()}`)}}),this.demos.set("Template Method",{name:"Template Method",type:"behavioral",description:"å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå°†æŸäº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»",file:"src/domain/checkout/pipeline/CheckoutPipeline.ts",run:async()=>{const{CheckoutPipeline:t}=await p(async()=>{const{CheckoutPipeline:a}=await import("./CheckoutPipeline-DhzDqX0E.js");return{CheckoutPipeline:a}},[],import.meta.url),{PremiumCheckoutPipeline:e}=await p(async()=>{const{PremiumCheckoutPipeline:a}=await import("./PremiumCheckoutPipeline-Bf6FaizM.js");return{PremiumCheckoutPipeline:a}},__vite__mapDeps([2,3]),import.meta.url);r.log("Template Method","=== Template Method æ¨¡å¼æ¼”ç¤º ===");const n={items:[{price:200,quantity:2}],memberLevel:"Gold"};r.log("Template Method","æ ‡å‡†ç»“ç®—æµç¨‹:"),new t().run(n),r.log("Template Method","é«˜çº§ä¼šå‘˜ç»“ç®—æµç¨‹ï¼ˆè¦†ç›–éƒ¨åˆ†æ­¥éª¤ï¼‰:"),new e().run(n),r.log("Template Method","æ¨¡æ¿æ–¹æ³•å®šä¹‰äº†å›ºå®šæµç¨‹ï¼Œå­ç±»å¯è¦†ç›–ç‰¹å®šæ­¥éª¤")}}),this.demos.set("Visitor",{name:"Visitor",type:"behavioral",description:"åœ¨ä¸æ”¹å˜å…ƒç´ ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºå…ƒç´ çš„æ–°æ“ä½œ",file:"src/domain/pricing/visitor/IPricingVisitor.ts",run:async()=>{const{PriceLine:t}=await p(async()=>{const{PriceLine:c}=await Promise.resolve().then(()=>J);return{PriceLine:c}},void 0,import.meta.url),{PriceGroup:e}=await p(async()=>{const{PriceGroup:c}=await Promise.resolve().then(()=>G);return{PriceGroup:c}},void 0,import.meta.url),{HtmlPricingVisitor:n}=await p(async()=>{const{HtmlPricingVisitor:c}=await Promise.resolve().then(()=>Yt);return{HtmlPricingVisitor:c}},void 0,import.meta.url),{JsonPricingVisitor:o}=await p(async()=>{const{JsonPricingVisitor:c}=await Promise.resolve().then(()=>Wt);return{JsonPricingVisitor:c}},void 0,import.meta.url),{TextPricingVisitor:s}=await p(async()=>{const{TextPricingVisitor:c}=await Promise.resolve().then(()=>Kt);return{TextPricingVisitor:c}},void 0,import.meta.url);r.log("Visitor","=== Visitor æ¨¡å¼æ¼”ç¤º ===");const a=new e("è®¢å•æ€»è®¡");a.add(new t("å•†å“å°è®¡",300)),a.add(new t("æŠ˜æ‰£",-30)),a.add(new t("ç¨è´¹",27)),a.add(new t("è¿è´¹",10)),r.log("Visitor","HTML å¯¼å‡º:");const u=new n;a.accept(u),r.log("Visitor",u.getResult().substring(0,100)+"..."),r.log("Visitor","JSON å¯¼å‡º:");const h=new o;a.accept(h),r.log("Visitor",h.getResult()),r.log("Visitor","Text å¯¼å‡º:");const d=new s;a.accept(d),r.log("Visitor",d.getResult())}}),this.demos.set("Interpreter",{name:"Interpreter",type:"behavioral",description:"ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å…¶æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨",file:"src/domain/coupon/dsl/Parser.ts",run:async()=>{const{Tokenizer:t}=await p(async()=>{const{Tokenizer:s}=await Promise.resolve().then(()=>zt);return{Tokenizer:s}},void 0,import.meta.url),{Parser:e}=await p(async()=>{const{Parser:s}=await Promise.resolve().then(()=>Qt);return{Parser:s}},void 0,import.meta.url),{Evaluator:n}=await p(async()=>{const{Evaluator:s}=await Promise.resolve().then(()=>Ut);return{Evaluator:s}},void 0,import.meta.url);r.log("Interpreter","=== Interpreter æ¨¡å¼æ¼”ç¤º ===");const o=["PERCENT 10 IF TOTAL > 200",'MINUS 30 IF CATEGORY == "Food"',"FREE_SHIP IF TOTAL > 300"];for(const s of o){r.log("Interpreter",`DSL: "${s}"`);const u=new t(s).tokenize();r.log("Interpreter",`  Tokens: ${u.map(y=>y.type).join(", ")}`);const d=new e(u).parse();r.log("Interpreter",`  AST: ${d.type} - ${d.action}`);const c=new n,g={total:350,category:"Food",shipping:15},L=c.evaluate(d,g);r.log("Interpreter",`  æ‰§è¡Œç»“æœ: ${JSON.stringify(L)}`)}}})}};i(P,"instance",null);let R=P;class ce{constructor(){i(this,"container");this.container=document.createElement("div"),this.container.className="patterns-grid"}render(){const t=R.getInstance().getAll(),e=t.filter(s=>s.type==="creational"),n=t.filter(s=>s.type==="structural"),o=t.filter(s=>s.type==="behavioral");return this.container.innerHTML=`
      <div style="grid-column: 1 / -1"><h2>åˆ›å»ºå‹æ¨¡å¼ (5)</h2></div>
      ${e.map(s=>this.renderCard(s)).join("")}
      <div style="grid-column: 1 / -1"><h2>ç»“æ„å‹æ¨¡å¼ (7)</h2></div>
      ${n.map(s=>this.renderCard(s)).join("")}
      <div style="grid-column: 1 / -1"><h2>è¡Œä¸ºå‹æ¨¡å¼ (11)</h2></div>
      ${o.map(s=>this.renderCard(s)).join("")}
    `,this.bindEvents(),this.container}renderCard(t){return`
      <div class="card pattern-card ${t.type}">
        <span class="pattern-type ${t.type}">${this.getTypeLabel(t.type)}</span>
        <h3 class="card-title">${t.name}</h3>
        <p class="pattern-description">${t.description}</p>
        <code class="pattern-file">${t.file}</code>
        <button class="btn btn-primary btn-run-demo" data-pattern="${t.name}">
          â–¶ Run Demo
        </button>
      </div>
    `}getTypeLabel(t){switch(t){case"creational":return"åˆ›å»ºå‹";case"structural":return"ç»“æ„å‹";case"behavioral":return"è¡Œä¸ºå‹";default:return t}}bindEvents(){this.container.querySelectorAll(".btn-run-demo").forEach(t=>{t.addEventListener("click",e=>{const n=e.target.dataset.pattern;n&&R.getInstance().runDemo(n)})})}}class le{getClassName(){return"btn-light"}render(){return'<button class="btn btn-light">Light Button</button>'}}class de{getClassName(){return"card-light"}render(){return'<div class="card card-light">Light Card</div>'}}class vt{createButton(){return new le}createCard(){return new de}getThemeName(){return"light"}}const ue=Object.freeze(Object.defineProperty({__proto__:null,LightThemeFactory:vt},Symbol.toStringTag,{value:"Module"}));class pe{getClassName(){return"btn-dark"}render(){return'<button class="btn btn-dark">Dark Button</button>'}}class he{getClassName(){return"card-dark"}render(){return'<div class="card card-dark">Dark Card</div>'}}class bt{createButton(){return new pe}createCard(){return new he}getThemeName(){return"dark"}}const me=Object.freeze(Object.defineProperty({__proto__:null,DarkThemeFactory:bt},Symbol.toStringTag,{value:"Module"}));class ge{getClassName(){return"btn-retro"}render(){return'<button class="btn btn-retro">Retro Button</button>'}}class ye{getClassName(){return"card-retro"}render(){return'<div class="card card-retro">Retro Card</div>'}}class ft{createButton(){return new ge}createCard(){return new ye}getThemeName(){return"retro"}}const ve=Object.freeze(Object.defineProperty({__proto__:null,RetroThemeFactory:ft},Symbol.toStringTag,{value:"Module"})),T=class T{constructor(){i(this,"currentTheme","light");i(this,"factories",new Map);this.factories.set("light",new vt),this.factories.set("dark",new bt),this.factories.set("retro",new ft)}static getInstance(){return T.instance||(T.instance=new T),T.instance}applyTheme(t){this.currentTheme=t,document.body.className=`theme-${t}`,r.log("Abstract Factory",`åˆ‡æ¢ä¸»é¢˜: ${t}`)}getCurrentTheme(){return this.currentTheme}getFactory(){return this.factories.get(this.currentTheme)}getAvailableThemes(){return Array.from(this.factories.keys())}};i(T,"instance",null);let D=T;class be{render(){const t=document.createElement("div");return t.innerHTML=`
      <h1 class="page-title">ğŸ¨ GoF 23 è®¾è®¡æ¨¡å¼</h1>
      <p class="mb-2">ç‚¹å‡» "Run Demo" æŒ‰é’®åœ¨å³ä¸‹è§’ Console æŸ¥çœ‹è¾“å‡º</p>
      
      <div class="card mb-2">
        <h3>ä¸»é¢˜åˆ‡æ¢ (Abstract Factory æ¨¡å¼)</h3>
        <div class="flex gap-1">
          <button class="btn btn-secondary" data-theme="light">â˜€ï¸ Light</button>
          <button class="btn btn-secondary" data-theme="dark">ğŸŒ™ Dark</button>
          <button class="btn btn-secondary" data-theme="retro">ğŸ“º Retro</button>
        </div>
      </div>
      
      <div id="patterns-container"></div>
    `,t.querySelector("#patterns-container").appendChild(new ce().render()),t.querySelectorAll("[data-theme]").forEach(n=>{n.addEventListener("click",o=>{const s=o.target.dataset.theme;D.getInstance().applyTheme(s),r.log("Abstract Factory",`ä¸»é¢˜å·²åˆ‡æ¢ä¸º: ${s}`)})}),t}}class fe{constructor(){i(this,"routes",[]);i(this,"contentContainer",null);this.setupRoutes()}setupRoutes(){this.routes=[{path:"",handler:()=>this.renderPage(z)},{path:"catalog",handler:()=>this.renderPage(z)},{path:"checkout",handler:()=>this.renderPage(Xt)},{path:"order",handler:()=>this.renderPage(se)},{path:"patterns",handler:()=>this.renderPage(be)}]}init(){var t;this.contentContainer=document.createElement("main"),this.contentContainer.className="main-content",(t=document.getElementById("app"))==null||t.appendChild(this.contentContainer),window.addEventListener("hashchange",()=>this.handleRoute()),this.handleRoute()}handleRoute(){const t=window.location.hash.slice(2)||"catalog",e=this.routes.find(n=>n.path===t);e?e.handler():this.navigate("catalog"),this.updateNavActive(t)}renderPage(t){if(!this.contentContainer)return;this.contentContainer.innerHTML="";const e=new t;this.contentContainer.appendChild(e.render())}navigate(t){window.location.hash=`/${t}`}updateNavActive(t){document.querySelectorAll(".navbar-nav a").forEach(e=>{var o;const n=((o=e.getAttribute("href"))==null?void 0:o.slice(2))||"";e.classList.toggle("active",n===t)})}getCurrentRoute(){return window.location.hash.slice(2)||"catalog"}}class _e{constructor(){i(this,"element");var t;this.element=document.createElement("nav"),this.element.className="navbar",this.render(),(t=document.getElementById("app"))==null||t.prepend(this.element),m.getInstance().subscribe(()=>this.updateCartCount())}render(){const t=m.getInstance(),e=D.getInstance();this.element.innerHTML=`
      <a href="#/catalog" class="navbar-brand">ğŸ›’ PatternMart</a>
      <ul class="navbar-nav">
        <li><a href="#/catalog">å•†å“</a></li>
        <li><a href="#/checkout">ç»“ç®—</a></li>
        <li><a href="#/order">è®¢å•</a></li>
        <li><a href="#/patterns">æ¨¡å¼</a></li>
      </ul>
      <div class="navbar-cart flex items-center gap-2">
        <select id="theme-select" class="form-control" style="width: auto;">
          <option value="light">â˜€ï¸ Light</option>
          <option value="dark">ğŸŒ™ Dark</option>
          <option value="retro">ğŸ“º Retro</option>
        </select>
        <a href="#/checkout" class="btn btn-secondary">
          ğŸ›’ <span class="cart-count">${t.getTotalQuantity()}</span>
        </a>
      </div>
    `;const n=this.element.querySelector("#theme-select");n.value=e.getCurrentTheme(),n.addEventListener("change",o=>{const s=o.target.value;e.applyTheme(s)})}updateCartCount(){const t=m.getInstance().getTotalQuantity(),e=this.element.querySelector(".cart-count");e&&(e.textContent=String(t))}}const E=class E{constructor(){i(this,"router");i(this,"navbar",null);i(this,"initialized",!1);this.router=new fe}static getInstance(){return E.instance||(E.instance=new E),E.instance}init(){if(this.initialized)return;const t=k.getInstance(),e=v.getInstance();t.info("App","åº”ç”¨åˆå§‹åŒ–å¼€å§‹"),r.log("Singleton",`AppConfig å®ä¾‹ ID: ${e.getInstanceId()}`),r.log("Singleton",`Logger å®ä¾‹ ID: ${t.getInstanceId()}`),D.getInstance().applyTheme("light"),m.getInstance().loadFromStorage(),this.navbar=new _e,R.getInstance().registerAll(),this.router.init(),r.render(),this.initialized=!0,t.info("App","åº”ç”¨åˆå§‹åŒ–å®Œæˆ"),r.log("App","ğŸš€ PatternMart å·²å¯åŠ¨ï¼æ¬¢è¿ä½“éªŒ GoF 23 è®¾è®¡æ¨¡å¼")}getRouter(){return this.router}updateCartCount(){var t;(t=this.navbar)==null||t.updateCartCount()}};i(E,"instance",null);let V=E;document.addEventListener("DOMContentLoaded",()=>{V.getInstance().init()});export{r as D};
